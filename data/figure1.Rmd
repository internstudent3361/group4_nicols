---
title: "figure1.Rmd"
author: "Angelina Lim"
date: "04/07/2021"
output: html_document
---


### loading libraries
```{r}
library(tidyverse)
library(janitor) #used to read csv
library(dplyr) #used for mutating variables
library(ggplot2) #used to plot column
library(ggdist) #used for raincloud plot

```

## reading nichols csv

```{r}

data1 <- read_csv("data/Nichols_et_al_data.csv")

```

## cleaning up variables 

We used the dplyr package to make the data much neater. Rename was used to clean up the variables to look more like the original. We also used filter and select to narrow down the variables we will be using for Fig 1. 

Claimpercent had to be mutated to become a percentage value, since they were in decimal place beforehand. Then, we used as_tibble to make the data easier to look at.

Originally had cond in select, but was told you cannot select a factor. Cond also changed to factor variable.

```{r}
data1 <- data1 %>%  
  filter(include == 0) %>% 
  rename(cond = con,
         claimpercent = claim,
         claimmoney = moneyclaim,
         CT_practice = `completion time (practice included)`,
         CT_payments = `completion time (payments only)`,
         religiosity = relig,
         religion = Religion) %>% 
  data1$cond <- as.factor(data1$cond) %>% 
  select(site, claimpercent, id) %>% 
  mutate(claimpercent = claimpercent * 100) %>% 
  as_tibble()

```

## fig 1 - data by condition

### rename each condition

We had to create a new claimpercent variable so each condition had a mean value instead. As such, we had to rename each condition.

```{r}

data1$cond[data1$cond==4] <- 0 # Make religious prime the reference category
data1$cond[data1$cond==1] <- 4 # This is in a weird order as R reads the code line by line, so if we go from top to bottom, 
data1$cond[data1$cond==3] <- 1 # we're changing the number twice which screws up our dataframe
data1$cond[data1$cond==4] <- 3

```

### mutating claimpercent

We used mutate from the dplyr package to create "claimpercent2", which would be the average value of each condition rather than all of the values.

```{r}

data1 <- data1 %>% 
  mutate(numberOf = (cond == 0) * 100 + (cond == 1 | cond == 2) * 103 + (cond == 3) * 102) %>% 
  mutate(claimpercent2 = claimpercent / numberOf)

```

### plotting fig 1 - data by condition

We used the ggdist package for "stat_halfeye" to create the cloud parts of the graph, and we combined it with geom_col to get the bar underneath. We had to mess with the width so both could fit in the respective x axis. 

"as.numeric(cond)+.5" was used to move the columns so they would fit with the cloud plot.

In the ggdist::stat_halfeye section, adjust changed the height so we could leave room for the column. ".width" and "point_colour" were a part of the original cloud plot but we removed them since they are not in Fig 1.

We used "coord_flip()" from ggplot2 to flip the graph to look like the original Figure 1. "ylab" was used to rename the y axis.

Error seems to be telling me that I cannot nudge a factor?

```{r}

fig1_condition_rp <- ggplot(data1, aes(x = cond)) +
  geom_col(
    aes(x = cond, y = claimpercent2),
    width = .3,
    position_nudge(x = .5)
  ) +
  ggdist::stat_halfeye(
    aes(y = claimpercent),
    adjust = .5,
    width = .5,
    .width = 0,
    point_colour = NA
  ) +
  coord_flip(
  ) +
  ylab("Percent Claimed")

plot(fig1_condition_rp)
```

suggestions from jenny s:
For the condition names, make sure the variable is a factor and try setting the "labels" of data1$cond before plotting. One option would be to check out  ?factor for more info.

I've personally never used stat_halfeye but great job discovering this function. There's an argument "position" and a function position_nudge() that you should be able to add to geom_col() and possibly also to stat_halfeye() to reposition when the columns are

hmm that's odd about ggplot not loading properly - perhaps try installing tidyverse again?
